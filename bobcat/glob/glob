#ifndef INCLUDED_BOBCAT_GLOB_
#define INCLUDED_BOBCAT_GLOB_

#include <string>
#include <memory>
#include <glob.h>

#include <iostream>

namespace FBB
{

class Glob
{
    struct GlobShare
    {
        glob_t      globStruct;
        int         globErr;
    };

    std::shared_ptr<GlobShare> d_share;

    public:
        enum Flags
        {
            // These flags are those used by glob.h

            ERR =       1 << 0, // Return on read globErrors.
            MARK =      1 << 1, // Append a slash to each name.
            NOSORT =    1 << 2, // Don't sort the names.
            NOESCAPE =  1 << 6, // Backslashes don't quote metacharacters.
            PERIOD =    1 << 7, // Leading `.' can be matched by metachars.
        };

        enum Dots
        {
            FIRST,
            DEFAULT
        };
            
        Glob(std::string const &pattern = "*", int flags = PERIOD,
             Dots dots = FIRST);

        size_t size() const;
        char const *operator[](size_t idx) const;
        char const *const *begin() const;
        char const *const *end() const;

        void verify() const;        // Superfluous: now empty function
    private:
        char const **mbegin() const;
        char const **mend() const;

        static void globShareDeleter(GlobShare *globShare);
        static bool isDot(char const *cp);
};

inline void Glob::globShareDeleter(GlobShare *globShare)
{
    if (!globShare->globErr)
        globfree(&globShare->globStruct);
}

inline void Glob::verify() const
{}

inline size_t Glob::size() const
{
    return d_share->globStruct.gl_pathc;
}

inline char const *Glob::operator[](size_t idx) const
{
    return idx < size() ? d_share->globStruct.gl_pathv[idx] : "";
}

inline char const *const *Glob::begin() const
{
    return d_share->globStruct.gl_pathv;
}

inline char const *const *Glob::end() const
{
    return d_share->globStruct.gl_pathv + size();
}

} // FBB
        
#endif




